services:
  # 1. The Web Server (Frappe LMS)
  - type: web
    name: lms-web
    env: docker
    plan: starter
    dockerfilePath: ./render/Dockerfile
    autoDeploy: true
    disk:
      name: bench-data
      mountPath: /workspace/bench
      sizeGB: 10
    envVars:
      - key: SITE_NAME
        value: lms.onrender.com
      - key: ADMIN_PASSWORD
        value: MPSD2002
      - key: MYSQL_HOST
        value: lms-mariadb
      - key: MYSQL_DATABASE
        value: lms
      - key: MYSQL_USER
        value: lms
      - key: MYSQL_PASSWORD
        value: MPSD2002
      - key: MYSQL_ROOT_PASSWORD
        value: MPSD2002
      - key: REDIS_HOST
        value: lms-redis

  # 2. The Database (MariaDB - Private Service)
  # using type: pserv prevents the "unknown type" error
  - type: pserv
    name: lms-mariadb
    env: image
    plan: starter
    image: mariadb:10.6
    disk:
      name: mariadb-data
      mountPath: /var/lib/mysql
      sizeGB: 10
    envVars:
      - key: MYSQL_ROOT_PASSWORD
        value: MPSD2002
      - key: MYSQL_DATABASE
        value: lms
      - key: MYSQL_USER
        value: lms
      - key: MYSQL_PASSWORD
        value: MPSD2002

  # 3. The Cache (Redis - Private Service)
  # using type: pserv bypasses the "IP allow list" requirement
  - type: pserv
    name: lms-redis
    env: image
    plan: starter
    image: redis:7-alpine
